<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, February 10, 2014, 8:02 PM -->
<!-- MuClient version 4.91 -->

<!-- Plugin "crystal_map_to_clipboard" generated by Plugin Wizard -->

<muclient>

<plugin
   name="crystal_map_to_clipboard"
   author="Ruthgul"
   id="15160c25503baa781f667459"
   language="Lua"
   purpose="copies the 21 lines of a crystal quest map to the clipboard"
   save_state="y"
   date_written="2014-02-10 20:01:01"
   date_modified="2016-10-24 09:47:17"
   requires="4.71"
   version="1.0"
   >
<description trim="y">

<![CDATA[

~ crystal_map_to_clipboard ~

Copies the 21 lines of a crystal quest map to the clipboard, when you look at the map.


Author: Ruthgul

]]>

</description>

</plugin>


<!--  Aliases  -->

<aliases>

<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^crystal\_map(|\_to\_clipboard)(|( |\:)help)$"
   regexp="y"
   ignore_case="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Triggers  -->

<triggers>

<!-- old stuff from the times when we had lore

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^(You focus your powers of observation on a tightly\-rolled scroll\:|Level 15 item \'a tightly\-rolled scroll\' is type parchment\, with keywords \'crystalquest(.*?) magic map scroll taramine\'\.)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>looked_at_map()
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^Level 15 item \'a tightly\-rolled scroll\' is type parchment\, with keywords \'crystalquest(.*?) magic map scroll tadamir\'\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>looked_at_map_no_lore()
</send>
  </trigger>

  <trigger
   name="start_map_capture"
   keep_evaluating="y"
   match="^(This level 15 item has the attributes\: identified insulated no\-save|\*A tightly\-rolled scroll will last approximately (.+) more Alyrian minute(|s)\.)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>got_header()
</send>
  </trigger>

end of old stuff -->

  <trigger
   enabled="y"
   multi_line="y"
   regexp="y"
   lines_to_match="4"
   keep_evaluating="y"
   match="^Item \'a tightly\-rolled scroll\' is type parchment\, alignment 0\, made of paper \(in \(new\) condition\)\,\nhas keywords \'crystalquest.+ magic map scroll tadamir\'\.\nThis item weighs 0 stones and 0 pebbles\, and is valued at 1 gold\. \nThis level 15 item has the attributes\: insulated no\-save$"
   send_to="12"
   sequence="100"
  >
  <send>looked_at_map_no_lore()
</send>
  </trigger>

  <trigger
   enabled="y"
   regexp="y"
   multi_line="y"
   group="Multi Line"
   lines_to_match="5"
   keep_evaluating="y"
   match="^Item \'a tightly\-rolled scroll\' is type parchment\, alignment 0\, made of paper \(in \(new\) condition\)\, \nhas keywords \'crystalquest.+ magic map scroll taramine\'\. \nThis item weighs 0 stones and 0 pebbles\, and is valued at 1 gold\.  \nThis level 15 item has the attributes\: no\-save \n\*A tightly\-rolled scroll will last approximately .+ more Alyrian minutes\. $"
   send_to="12"
   sequence="100"
  >
  <send>looked_at_map_no_lore()
</send>
  </trigger>

  <trigger
   name="map_line"
   keep_evaluating="y"
   match="^(.+)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>got_map_line("%1")
</send>
  </trigger>

  <trigger
   name="map_end"
   keep_evaluating="y"
   match="^(|[^ ]+(.*?))(\&lt;(.+)hp (.+)sp (.+)st\&gt;|\(.+\)|\&gt;) $"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>got_prompt()
</send>
  </trigger>

</triggers>



<!--  Scripts  -->

<script>

<![CDATA[

function OnPluginInstall()
  Note(GetPluginInfo(GetPluginID(), 1) .. ": type " .. GetPluginInfo(GetPluginID(), 1) .. " help to see info about this plugin")
end


function OnHelp()
  world.Note(world.GetPluginInfo(world.GetPluginID(), 3))
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/crystal_map_to_clipboard.xml",
  }
  return (table.concat(t, ";"))
end



--------------
-- map stuff
--------------

-- this is no longer needed, since we don't have lore
function looked_at_map()
  EnableTrigger("start_map_capture", true)
  EnableTrigger("map_end", true)

  crystal_map = ""
  map_lines = 0
end


-- this is no longer needed, since we don't have lore
function got_header()
  EnableTrigger("start_map_capture", false)
  EnableTrigger("map_line", true)
end


function looked_at_map_no_lore()
  EnableTrigger("map_line", true)
  EnableTrigger("map_end", true)

  crystal_map = ""
  map_lines = 0
end


function got_map_line(line)
  if (map_lines < 21) then
    crystal_map = crystal_map .. line .. "\r\n"
    map_lines = map_lines + 1
  end
end


function got_prompt()
  EnableTrigger("map_line", false)
  EnableTrigger("map_end", false)
  --Note(crystal_map)
  SetClipboard(crystal_map)
end


]]>

</script>

</muclient>
