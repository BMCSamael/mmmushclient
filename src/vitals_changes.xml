<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, April 24, 2012, 12:04 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "vitals_changes" generated by Plugin Wizard -->

<muclient>

<plugin
   name="vitals_changes"
   author="Ruthgul"
   id="4f76c77c73affc51fa8fc841"
   language="Lua"
   purpose="shows hp/sp/st losses and gains, near the prompt"
   date_written="2012-04-24 12:02:30"
   date_modified="2014-12-04 16:36:27"
   requires="4.71"
   version="1.0"
   >


<description trim="y">

<![CDATA[

.------------------.
 | vitals_changes |
`------------------'

Shows hp/sp/st losses and gains, after the prompt.

Note: edit fgincrease, fgsame, and fgdecrease to change colors.


Syntax:
* log {hp|sp|st}  - starts/stops logging the chosen vital to a notepad


*** REQUIRES ***

- Client setting: Game, Configure, Output > [x] Convert IAC EOR/GA to new line (must be checked).


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Aliases  -->

<aliases>

  <alias
   match="^log (hp|sp|st)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>toggle_logging("%1")
</send>
  </alias>


<!--  Plugin help  -->

  <alias
   script="OnHelp"
   match="^vitals(|\_changes)(|( |\:)help)$"
   regexp="y"
   enabled="y"
  >
  </alias>

</aliases>



<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="script-vitals_mod"
   keep_evaluating="y"
   match="^(.*?)\&lt;(?P&lt;hp&gt;.+)hp (?P&lt;sp&gt;.+)sp (?P&lt;st&gt;.+)st\&gt; $"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>show_changes("%&lt;hp&gt;", "%&lt;sp&gt;", "%&lt;st&gt;")
</send>
  </trigger>
</triggers>



<!--  Scripts  -->

<script>

<![CDATA[

-- you can change your colors here
fgincrease = "dodgerblue"    -- color used to display increments in vitals
fgsame = "dodgerblue"        -- color used to display unchanged vitals (0)
fgdecrease = "dodgerblue"    -- color used to display decrements in vitals


function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
  Note(" to see info about this plugin --")

  load_config()
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/vitals_changes.xml",
  }
  return (table.concat(t, ";"))
end


function load_config()
  log_hp = ((GetVariable("log_hp") or "false") == "true")
  log_sp = ((GetVariable("log_sp") or "false") == "true")
  log_st = ((GetVariable("log_st") or "false") == "true")
end


function save_config()
  SetVariable("log_hp", tostring(log_hp))
  SetVariable("log_sp", tostring(log_sp))
  SetVariable("log_st", tostring(log_st))

  SaveState()
end


function toggle_logging(what)
  if (what == "hp") then
    log_hp = not log_hp
    notify_toggle("hp", log_hp)

  elseif (what == "sp") then
    log_sp = not log_sp
    notify_toggle("sp", log_sp)

  elseif (what == "st") then
    log_st = not log_st
    notify_toggle("st", log_st)
  end

  save_config()
end


function notify_toggle(name, value)
  if (value) then
    Note("-- vitals_changes: will start logging " .. name .. " to the 'vitals changes' notepad --")
  else
    Note("-- vitals_changes: no longer logging " .. name)
  end
end


function show_changes(hp, sp, st)
  local hpdiff = tonumber(hp) - tonumber(oldhp or 0)
  local spdiff = tonumber(sp) - tonumber(oldsp or 0)
  local stdiff = tonumber(st) - tonumber(oldst or 0)

  if (hpdiff ~= 0) or (spdiff ~= 0) or (stdiff ~= 0) then
    show_vital(hpdiff)
    Tell(" ")
    show_vital(spdiff)
    Tell(" ")
    show_vital(stdiff)
    Note("") -- end of line

    log_stuff(hpdiff, spdiff, stdiff)
  end

  oldhp = hp
  oldsp = sp
  oldst = st
end


function show_vital(num)
  local fgcolor = "blue" -- default color

  if (num > 0) then
    num = "+" .. num
    fgcolor = fgincrease

  elseif (num < 0) then
    fgcolor = fgdecrease

  else -- it's 0
    fgcolor = fgsame
  end

  ColourTell(fgcolor, "black", num)
end



function log_stuff(hpdiff, spdiff, stdiff)
  local hpstr, spstr, ststr

  if (log_hp) then
    hpstr = hpdiff
  end

  if (log_sp) then
    spstr = spdiff
  end

  if (log_st) then
    ststr = stdiff
  end

  if (hpstr) or (spstr) or (ststr) then
    local str = (hpstr or "-") .. ", " .. (spstr or "-") .. ", " .. (ststr or "-")
    AppendToNotepad("vitals changes", str .. "\r\n")
  end
end


]]>

</script>

</muclient>
