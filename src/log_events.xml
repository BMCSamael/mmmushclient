<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, March 05, 2015, 2:57 PM -->
<!-- MuClient version 4.94 -->

<!-- Plugin "log_events" generated by Plugin Wizard -->

<muclient>

<plugin
   name="log_events"
   author="Ruthgul"
   id="0084625af85a3786d14c5b8d"
   language="Lua"
   purpose="shows common stuff in the events miniwindow"
   save_state="y"
   date_written="2015-03-05 14:55:56"
   date_modified="2015-03-05 17:03:44"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.--------------.
 | log_events |
`--------------'

Shows common stuff in the events miniwindow.

It currently supports:
- betters;
- hunter tells / rifts.

If you want more events added to this plugin, please send Ruthgul a tell, or a parchment (including the full string for the event + what it means).


Author: Ruthgul


Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Aliases  -->

<aliases>

<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^log\_events(|(\:| )help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Triggers  -->

<triggers>

<!-- betters &c -->

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^You have made some progress towards improving your skill in \'(.+)\'\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("gray", "black", "progress: %1")
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^(You have become more learned at|You learn from your mistakes\, and your knowledge of) \'(?P&lt;skill&gt;.+)\'(| improves\.) \((.+)\%\)(|\.)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("silver", "black", "better: %&lt;skill&gt;")
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^You have become a master at \'(.+)\'.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("white", "black", "master: %1")
</send>
  </trigger>


<!-- hunters / masters -->
  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^(?P&lt;name&gt;[A-Za-z]+)\, the Archon Hunter(?P&lt;master&gt;.*?) tells you(|\,) \'(.+)\'$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("white", "indigo", "*** Hunter%&lt;master&gt; tell: %&lt;name&gt; ***")
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^Something tells you(|\,) \'(.+)\'$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("whitesmoke", "navy", "Eth Hunter tell?")
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^(?P&lt;name&gt;[A-Za-z]+)\, the Archon Hunter(?P&lt;master&gt;.*?) steps through the rift\, which closes quietly afterwards\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("white", "maroon", "*** Hunter%&lt;master&gt; rift: %&lt;name&gt; ***")
</send>
  </trigger>

  <trigger
   enabled="y"
   keep_evaluating="y"
   match="^(S|s)omething steps through the rift, which closes quietly afterwards\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>add_to_events_mini("white", "maroon", "Eth Hunter rift?")
</send>
  </trigger>

</triggers>



<!--  Scripts  -->

<script>

<![CDATA[

require "wait"


-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  wait.make(function()
    Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
    ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
    Note(" to see info about this plugin --")

    -- give the plugins time to initialize
    wait.time(3)
    detect_plugins()
  end)
end


function OnPluginListChanged()
  detect_plugins()
end


function detect_plugins()
  events_mini_present = events_mini_installed()
end


function is_plugin_present(name, id)
  local res = false

  local plugin_name = GetPluginInfo(id, 1)

  if (plugin_name == name) then
    -- is it enabled?
    if (GetPluginInfo(id, 17)) then
      res = true
    end
  end

  return res
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/log_events.xml",
  }
  return (table.concat(t, ";"))
end




----------------------
-- events mini stuff
----------------------

function add_to_events_mini(fgcol, bgcol, txt)
  if (events_mini_present) then
    add_style_to_events_mini("silver", "black", "[".. os.date("%H:%M:%S") .. "] ")
    add_style_to_events_mini(fgcol, bgcol, txt)
    add_style_to_events_mini("silver", "black", "\r\n")
  end
end


function add_style_to_events_mini(fgcol, bgcol, txt)
  CallPlugin("9ced43d0a7b4a60116794096", "add_to_mini", fgcol, bgcol, txt)
end


function events_mini_installed()
  return is_plugin_present("events_mini", "9ced43d0a7b4a60116794096")
end


]]>

</script>

</muclient>



<!--

test strings:

You have become more learned at 'enhanced damage' (86%).
You learn from your mistakes, and your knowledge of 'bash' improves. (91%)
You have made some progress towards improving your skill in 'second attack'!
You have become a master at 'halberd'.

Marchosias, the Archon Hunter Master tells you, 'The pylons do not ward off the Ithrix, but ward off courage. There is no honor in thy cowardice, S.'
Kylena, the Archon Hunter tells you, 'Those Glyph will not always be around to save thee, U! Your head shall be my trophy!'
Kylena, the Archon Hunter tells you, 'Thou canst hide from me forever, R. I shall be back...'
Something tells you, 'The joke is on thee, T; those pylons may slow me, but they shall ultimately kill thee. They cannot be trusted.'
Something tells you, 'Thou canst hide from me forever, H. I shall be back...'
something steps through the rift, which closes quietly afterwards.
Kylena, the Archon Hunter steps through the rift, which closes quietly afterwards.
Paimon, the Archon Hunter Master steps through the rift, which closes quietly afterwards.

-->
