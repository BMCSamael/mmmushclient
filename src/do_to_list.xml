<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, January 03, 2015, 11:30 AM -->
<!-- MuClient version 4.94 -->

<!-- Plugin "do_to_list" generated by Plugin Wizard -->

<!--

request: make a plugin or something that would take a pasted list of names, and churn out (at a rate that would not flood the server) "mail [name] invitation"

-->


<muclient>

<plugin
   name="do_to_list"
   author="Ruthgul"
   id="1079f88c024e8171e2d91e76"
   language="Lua"
   purpose="sequentially do an action to a list of players"
   save_state="y"
   date_written="2015-01-03 11:28:55"
   date_modified="2015-02-23 07:45:23"
   requires="4.73"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.--------------.
 | do_to_list |
`--------------'

Does an action, sequentially, to a list of players.


* automail <item>  - sequentially emails the item to a list of players that you copied to your clipboard (must be 1 player name per line) - eg, automail invitation

* autodo  - sequentially does the action defined in the 'doaction' alias, to a list of players that you copied to your clipboard (must be 1 player name per line)

  NOTICE: autodo REQUIRES that you create a 'doaction *' alias, like this:
    alias: autodo *
    send: mail invitation %1
    send to: world
  (the example above would do the same as running 'automail invitation')


>> Edit the wait_delay variable to tweak the frequency <<


Author: Ruthgul

]]>

</description>

</plugin>



<!-- Variables -->

<variables>

  <variable name="wait_delay">0.5</variable>   <!-- frequency, in seconds -->

</variables>



<!--  Aliases  -->

<aliases>

  <alias
   enabled="y"
   match="^automail[ ]+(?P&lt;item&gt;.+)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>seq_automail("%&lt;item&gt;")
</send>
  </alias>

  <alias
   enabled="y"
   match="^autodo$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>seq_autodo()
</send>
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^do\_to\_list(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Scripts  -->

<script>

<![CDATA[

require "wait"


-----------
-- plugin
-----------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
  Note(" to see info about this plugin --")
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/do_to_list.xml",
  }
  return (table.concat(t, ";"))
end



-----------------
-- autodo stuff
-----------------

function seq_automail(item)
  wait.make(function()
    local list = GetClipboard()

    local wait_delay = tonumber(GetVariable("wait_delay")) or 0.5

    for name in string.gmatch(list, "%a+") do
      Send("mail " .. item .. " " .. name)
      wait.time(wait_delay)
    end
  end)
end


function seq_autodo()
  wait.make(function()
    local list = GetClipboard()

    local wait_delay = tonumber(GetVariable("wait_delay")) or 0.5

    for name in string.gmatch(list, "%a+") do
      Execute("doaction " .. name)
      wait.time(wait_delay)
    end
  end)
end


]]>

</script>

</muclient>
