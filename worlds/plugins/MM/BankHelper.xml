<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, September 21, 2012, 11:49 PM -->
<!-- MuClient version 4.73 -->

<!-- Plugin "BankHelper" generated by Plugin Wizard -->

<muclient>
<plugin
   name="BankHelper"
   author="Elbereth, Sorta, Ruthgul really."
   id="d553d532b7fd796f3c0759c8"
   language="Lua"
   save_state="y"
   date_written="2012-09-21 23:48:16"
   requires="4.73"
   version="1.0"
   >
<description trim="y">
<![CDATA[
bank deposit to x - deposits all but x gold.
bank withdraw to x - withdraws to x gold onhand
]]>
</description>

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match="^You have a total of \[(?P&lt;inbank&gt;)[0-9\,]+\] gp in [0-9]+ accounts\, with \[(?P&lt;onhand&gt;[0-9\,]+)\] gp on hand\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>onhand = string.gsub("%&lt;onhand&gt;", ",", "")
onhand = tonumber(onhand)
</send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="^bank deposit to (?P&lt;target&gt;[0-9]+)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>require "wait"

wait.make (function ()
  -- whatever you do before
  onhand = nil
  Send("$")
  while (not onhand) do
    wait.time(1)
  end
  -- onhand is now not nil
  Send("bank deposit " .. onhand - %&lt;target&gt;)
end)
</send>
  </alias>
  <alias
   match="^bank withdraw to (?P&lt;target&gt;[0-9]+)$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>require "wait"

wait.make (function ()
  -- whatever you do before
  onhand = nil
  Send("$")
  while (not onhand) do
    wait.time(1)
  end
  Send("bank withdraw " .. %&lt;target&gt; - onhand)
  -- gold is now not nil
end)
</send>
  </alias>
</aliases>

<!--  Plugin help  -->

<aliases>
  <alias
   script="OnHelp"
   match="bank help"
   enabled="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[
function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end
]]>
</script>

</muclient>
