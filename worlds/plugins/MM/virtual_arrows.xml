<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, February 23, 2012, 3:36 AM -->
<!-- MuClient version 4.73 -->

<!-- Plugin "virtual_arrows" generated by Plugin Wizard -->

<muclient>

<plugin
   name="virtual_arrows"
   author="Ruthgul"
   id="3c56fcf3317c6230888de0f6"
   language="Lua"
   purpose="on-screen movement arrows"
   save_state="y"
   date_written="2012-02-23 03:34:59"
   date_modified="2013-04-23 09:48:56"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.------------------.
 | virtual_arrows |
`------------------'

Shows directional arrows on screen. Meant to help with movement on PCs that lack a numeric pad.


Usage:
- click on an arrow, to move in the arrow's direction
- alt + click on an arrow, to look in the arrow's direction
- ctrl + click on an arrow, to open a door in the arrow's direction
- ctrl + alt + click on an arrow, to flee in the arrow's direction


Syntax:

* virtual arrows (or ctrl + alt + a)  - to toggle the miniwindow on/off


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts


]]>

</description>

</plugin>



<!--  Aliases  -->

<aliases>

  <alias
   match="^virtual arrows$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>va_toggle()
</send>
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^virtual\_arrows(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!-- scripts -->

<script>

<![CDATA[

require "movewindow"

-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID (), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID (), 1) .. " help")
  Note(" to see info about this plugin --")
  va_start()
  AcceleratorTo("ctrl+alt+a", "va_toggle()", sendto.script)
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID (), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo (GetPluginID(), 14)) .. ")")
end


function OnPluginClose()
  va_stop()
  Accelerator("ctrl+alt+a", "")
end


function OnPluginEnable()
  show_window()
  AcceleratorTo("ctrl+alt+a", "va_toggle()", sendto.script)
end


function OnPluginDisable()
  hide_window()
  Accelerator("ctrl+alt+a", "")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/virtual_arrows.xml",
  }
  return (table.concat(t, ";"))
end


function plugin_update_aux_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/res/buttons.png",
  }
  return (table.concat(t, ";"))
end


---------------------
-- miniwindow stuff
---------------------

function va_start()
  redraw_window()
  make_hotspots()
  va_stat = true
end


function va_stop()
  hide_window()
end


function redraw_window()
  width = 80
  height = 60

  bgcol = ColourNameToRGB("black")

  vawin = "va_window_" .. GetPluginID ()
  WindowCreate (vawin, 0, 0, 0, 0, 0, 0, 0)

  windowinfo = movewindow.install(vawin, miniwin.pos_top_center)

  WindowShow(vawin, false)

  WindowCreate(vawin, windowinfo.window_left, windowinfo.window_top, width, height, windowinfo.window_mode, windowinfo.window_flags, bgcol)

  -- let them move it around
  movewindow.add_drag_handler(vawin, 20, 20, 40, 40, 10)

  -- load plugin's directory
  local pathname = GetPluginInfo (GetPluginID (), 20)
  local filename = "buttons.png"

  -- load image, show it
  local f = assert (io.open (pathname .. filename, "rb"))
  va_img = f:read ("*a")
  f:close ()
  WindowLoadImageMemory (vawin, "va", va_img)
  WindowDrawImage (vawin, "va", 0, 0, 0, 0, miniwin.image_copy)

  WindowShow(vawin, true)
end


function show_window()
  WindowShow(vawin, true)
end


function hide_window()
  WindowShow(vawin, false)
end


function va_toggle()
  if (not va_stat) then
    va_stat = true
    show_window()
    Note("-- virtual_arrows is now ON --")

  else
    va_stat = false
    hide_window()
    Note("-- virtual_arrows is now OFF --")
  end
end


-------------------
-- hotspots stuff
-------------------

function make_hotspots()
	WindowAddHotspot(vawin, "nw", 0, 0, 20, 20, "", "", "mousedown", "cancelmousedown", "mouseup", "nw", 3, 0)
	WindowAddHotspot(vawin, "n", 20, 0, 40, 20, "", "", "mousedown", "cancelmousedown", "mouseup", "n", 3, 0)
	WindowAddHotspot(vawin, "ne", 40, 0, 60, 20, "", "", "mousedown", "cancelmousedown", "mouseup", "ne", 3, 0)
	WindowAddHotspot(vawin, "u", 60, 0, 80, 20, "", "", "mousedown", "cancelmousedown", "mouseup", "u", 3, 0)

	WindowAddHotspot(vawin, "w", 0, 20, 20, 40, "", "", "mousedown", "cancelmousedown", "mouseup", "w", 3, 0)
	WindowAddHotspot(vawin, "e", 40, 20, 60, 40, "", "", "mousedown", "cancelmousedown", "mouseup", "e", 3, 0)

	WindowAddHotspot(vawin, "sw", 0, 40, 20, 60, "", "", "mousedown", "cancelmousedown", "mouseup", "sw", 3, 0)
	WindowAddHotspot(vawin, "s", 20, 40, 40, 60, "", "", "mousedown", "cancelmousedown", "mouseup", "s", 3, 0)
	WindowAddHotspot(vawin, "se", 40, 40, 60, 60, "", "", "mousedown", "cancelmousedown", "mouseup", "se", 3, 0)
	WindowAddHotspot(vawin, "d", 60, 40, 80, 60, "", "", "mousedown", "cancelmousedown", "mouseup", "d", 3, 0)
end


function mousedown(flags, hs_id)
  clear_flags()
  dir = nil

  if (flags == miniwin.hotspot_got_control + miniwin.hotspot_got_lh_mouse) then
    open = true -- ctrl + click => open
    dir = hs_id

  elseif (flags == miniwin.hotspot_got_alt + miniwin.hotspot_got_lh_mouse) then
    look = true -- alt + click => look
    dir = hs_id

  elseif (flags == miniwin.hotspot_got_control + miniwin.hotspot_got_alt + miniwin.hotspot_got_lh_mouse) then
    flee = true -- ctrl + alt + click => flee
    dir = hs_id

  elseif (flags == miniwin.hotspot_got_lh_mouse) then
    walk = true -- just click => move
    dir = hs_id
  end
end


function cancelmousedown(flags, hs_id)
  clear_flags()
  dir = nil
end


function mouseup(flags, hs_id)
  if (dir ~= nil) then
    if (flee) then
      Send("flee " .. dir)

    elseif (look) then
      Send("look " .. dir)

    elseif (open) then
      Send("open " .. dir .. " door")

    elseif (walk) then
      Send(dir)
    end
  end
end


----------
-- flags
----------

function clear_flags()
  flee = false
  look = false
  open = false
  walk = false
end


]]>

</script>

</muclient>
