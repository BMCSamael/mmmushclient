<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, July 09, 2012, 12:00 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "meh_sort" generated by Plugin Wizard -->

<muclient>

<plugin
   name="meh_sort"
   author="Ruthgul"
   id="598d2a61318e7e4604d54fe8"
   language="Lua"
   purpose="shows marks and bosses in alphabetical order"
   save_state="y"
   date_written="2012-07-09 11:58:36"
   date_modified="2013-10-20 17:48:47"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.------------.
 | meh_sort |
`------------'

Shows lists of marks and bosses in alphabetical order.


Syntax:

- meh sort [on|off]  - to toggle the sorting script on/off.


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Aliases  -->

<aliases>

  <alias
   match="^meh[ ]+sort(|[ ]+(?P&lt;status&gt;(on|off)))$"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>toggle_status("%&lt;status&gt;")</send>
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^meh\_sort(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Triggers  -->

<triggers>

<!-- marks -->

  <trigger
   name="start_marks"
   group="(m)"
   keep_evaluating="y"
   match="^You have obtained the following Marks\:$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>sort_marks_start()
</send>
  </trigger>

  <trigger
   name="capture_marks"
   group="(m)"
   keep_evaluating="y"
   match="^(.+)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>sort_marks_line("%0")
</send>
  </trigger>

  <trigger
   name="end_marks"
   group="(m)"
   keep_evaluating="y"
   match="^You have (.+) of (.+) available Marks\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>sort_marks_end("%0")
</send>
  </trigger>


<!-- bosses -->

  <trigger
   name="start_bosses"
   group="(b)"
   keep_evaluating="y"
   match="^You have killed\:$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>sort_bosses_start()
</send>
  </trigger>

  <trigger
   name="capture_bosses"
   group="(b)"
   keep_evaluating="y"
   match="^\* (?P&lt;boss&gt;.+)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>sort_bosses_line("%&lt;boss&gt;")
</send>
  </trigger>

  <trigger
   name="end_bosses"
   group="(b)"
   keep_evaluating="y"
   match="^You have killed a total of (.+) bosses\, for a total of (.+) practices\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>sort_bosses_end("%0")
</send>
  </trigger>

</triggers>



<!--  Scripts  -->


<script>

<![CDATA[


-----------
-- plugin
-----------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID (), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID (), 1) .. " help")
  Note(" to see info about this plugin --")

  load_config()
end


function OnHelp ()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID (), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo (GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/meh_sort.xml",
  }
  return (table.concat(t, ";"))
end



------------------
-- toggle status
------------------

function load_config()
  do_sort = true

  config_sort()
end


function toggle_status(status)
  if (status == "on") then
    do_sort = true

  elseif (status == "off") then
    do_sort = false

  elseif (status == "") then
    do_sort = not do_sort
  end

  if (do_sort) then
    Note("-- meh_sort: sorting of marks and bosses ON --")

  else
    Note("-- meh_sort: sorting of marks and bosses OFF --")
  end

  config_sort()
end


function config_sort()
  if (do_sort) then
    EnableTriggerGroup("(m)", true)
    EnableTrigger("capture_marks", false)
    EnableTrigger("end_marks", false)

    EnableTriggerGroup("(b)", true)
    EnableTrigger("capture_bosses", false)
    EnableTrigger("end_bosses", false)

  else
    EnableTriggerGroup("(m)", false)
    EnableTriggerGroup("(b)", false)
  end
end



---------------
-- sort marks
---------------

function sort_marks_start()
  EnableTrigger("capture_marks", true)
  EnableTrigger("end_marks", true)
  tmarks = {}
end


function sort_marks_line(line)
  if (not string.find(line, "You have")) then
    local tmline = utils.split(Trim(line), " ")

    for i = 1, #tmline do
      if (tmline[i] ~= "") then
        tmarks[#tmarks + 1] = tmline[i]
      end
    end
  end
end


function sort_marks_end(line)
  EnableTrigger("capture_marks", false)
  EnableTrigger("end_marks", false)
  table.sort (tmarks)

  --require "serialize"
  --Note(serialize.save_simple(tmarks))

  local s = ""
  for i = 1, #tmarks do
    s = s .. tmarks[i] .. string.rep (" ", 27 - string.len(tmarks[i]))
    if (math.fmod(i, 3) == 0) then
      ColourNote("yellow", "black", Trim(s))
      s = ""
    end
  end

  if (s ~= "") then
    ColourNote("yellow", "black", Trim(s))
  end

  ColourNote("silver", "black", line)
end



----------------
-- sort bosses
----------------

function sort_bosses_start()
  EnableTrigger("capture_bosses", true)
  EnableTrigger("end_bosses", true)
  tbosses = {}
end


function sort_bosses_line(boss)
  local sboss

  if (string.find(boss, "the ") == 1) then
    sboss = string.sub(boss, 5, string.len(boss))
  elseif (string.find(boss, "an ") == 1) then
    sboss = string.sub(boss, 4, string.len(boss))
  elseif (string.find(boss, "a ") == 1) then
    sboss = string.sub(boss, 3, string.len(boss))
  else
    sboss = boss
  end

  tbosses[#tbosses + 1] = string.lower(sboss) .. ";" .. boss
end


function sort_bosses_end(line)
  EnableTrigger("capture_bosses", false)
  EnableTrigger("end_bosses", false)
  table.sort (tbosses)

  --require "serialize"
  --Note(serialize.save_simple(tbosses))

  local fontcol, t
  for i = 1, #tbosses do
    ColourTell("yellow", "black", "* ")

    if (math.fmod(i, 2) == 0) then
      fontcol = "cyan"
    else
      fontcol = "teal"
    end

    t = utils.split(tbosses[i], ";")
    ColourNote(fontcol, "black", t[2])
  end

  ColourNote("red", "black", line)
end


]]>

</script>

</muclient>
