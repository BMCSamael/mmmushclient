<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 08, 2012, 7:51 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "bazaar_walk" generated by Plugin Wizard -->

<muclient>
<plugin
   name="bazaar_walk"
   author="Ruthgul"
   id="118122989b315b5a97526fcc"
   language="Lua"
   purpose="speedwalks you to a vendor in Bazaar"
   save_state="y"
   date_written="2012-08-08 19:49:42"
   date_modified="2013-12-15 09:32:45"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.---------------.
 | bazaar_walk |
`---------------'

** REQUIRES **

- Speedwalk_Manager_GMCP_P2, to actually walk to the target room


Syntax:

* bwalk {<clan_number>|<player_name>}  - walks you to the shop in Bazaar


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>


<!--  Aliases  -->

<aliases>

  <alias
   match="^bwalk[ ]+(?P&lt;vendor&gt;.+)$"
   enabled="y"
   group="script-bazaar"
   regexp="y"
   send_to="12"
   keep_evaluating="y"
   sequence="100"
  >
  <send>search_for_vendor("%&lt;vendor&gt;")
</send>
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^bazaar\_walk(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>


<!--  Triggers  -->

<triggers>

  <trigger
   enabled="y"
   group="script-bazaar"
   keep_evaluating="y"
   match="^You sense that (.+) may be located (?P&lt;path&gt;.+)\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>queue_directions("%&lt;path&gt;")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="script-bazaar"
   keep_evaluating="y"
   match="^(There is no vendor leased by a (character matching that name|clan of that number)|You are not able to sense the direction of that vendor from your current location)\.\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>EnableTriggerGroup("script-bazaar", false)
</send>
  </trigger>

</triggers>


<!--  Scripts  -->

<script>

<![CDATA[

-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
  Note(" to see info about this plugin --")
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/bazaar_walk.xml",
  }
  return (table.concat(t, ";"))
end


-------------------------
-- bazaar search & walk
-------------------------

function search_for_vendor(vendor)
  Note("walking to vendor: " .. vendor)
  EnableTriggerGroup("script-bazaar", true)
  Send("vendor where " .. vendor)
end


function queue_directions(path)
  local aux = Trim(path)
  aux = string.gsub(aux, "ne", "(ne)")
  aux = string.gsub(aux, "se", "(se)")
  aux = string.gsub(aux, "sw", "(sw)")
  aux = string.gsub(aux, "nw", "(nw)")

  local taux = utils.split(aux, ",")

  -- add auto-open for the last door
  local lastdir = taux[#taux]
  table.insert(taux, #taux, "o" .. lastdir)

  aux = table.concat(taux, " ")

  Execute("spd2 " .. aux)
  EnableTriggerGroup("script-bazaar", false)
end


]]>

</script>

</muclient>
