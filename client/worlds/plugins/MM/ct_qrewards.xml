<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, June 21, 2012, 10:06 AM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "ct_qrewards" generated by Plugin Wizard -->

<muclient>

<plugin
   name="ct_qrewards"
   author="Ruthgul"
   id="9249299865b9d174ff96adbe"
   language="Lua"
   purpose="reports quest complete rewards on ct"
   save_state="y"
   date_written="2012-06-21 10:04:20"
   date_modified="2013-10-26 20:26:44"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.---------------.
 | ct_qrewards |
`---------------'

Edit the variables col1 & col2 to change colors.


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Variables  -->

<variables>

  <variable name="col1">|C</variable>

  <variable name="col2">|D</variable>

</variables>



<!--  Triggers  -->

<triggers>

<!-- regular quests -->

  <trigger
   enabled="y"
   group="quest"
   keep_evaluating="y"
   match="^(Lord|Lady|Baron) (?P&lt;qm&gt;.+) tells you\, \'As a reward for thy valor\, I am awarding you (?P&lt;qp&gt;[0-9\,]+) quest point(|s)(|\, (|and )(?P&lt;exp&gt;[0-9\,]+) experience point(|s))(|\, (|and )(?P&lt;ap&gt;[0-9\,]+) archon point(|s))(|\, (|and )(?P&lt;bp&gt;[0-9\,]+) building point(|s))(|\, (|and )(?P&lt;piety&gt;[0-9\,]+) piety)(|\, (|and )(?P&lt;pp&gt;[0-9\,]+) practice(|s))(|\, and (?P&lt;gp&gt;[0-9\,]+) gold piece(|s))\.\'$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>report_rewards("%&lt;qm&gt;", "%&lt;qp&gt;", "%&lt;exp&gt;", "%&lt;ap&gt;", "%&lt;bp&gt;", "%&lt;piety&gt;", "%&lt;pp&gt;", "%&lt;gp&gt;")
</send>
  </trigger>


<!-- crystal quests -->

  <trigger
   enabled="y"
   match="^You give a (.+) crystal to Tadamir the guildsman\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_start_capture()
</send>
  </trigger>

  <trigger
   group="capture_crystal"
   match="^Tadamir the guildsman gives you (?P&lt;gp&gt;.+) gold coins\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_capture_gold("%&lt;gp&gt;")
</send>
  </trigger>

  <trigger
   group="capture_crystal"
   match="^You gain (?P&lt;qp&gt;.+) quest points\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_capture_qp("%&lt;qp&gt;")
</send>
  </trigger>

  <trigger
   group="capture_crystal"
   match="^You gain (?P&lt;exp&gt;.+) experience points\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_capture_exp("%&lt;exp&gt;")
</send>
  </trigger>

  <trigger
   group="capture_crystal"
   match="^You gain (?P&lt;pp&gt;.+) practice(|s)\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_capture_pp("%&lt;pp&gt;")
</send>
  </trigger>

  <trigger
   group="capture_crystal"
   match="^$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>crystal_end_capture()
</send>
  </trigger>

</triggers>



<!--  Aliases  -->

<aliases>

<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^ct\_qrewards(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Scripts  -->

<script>

<![CDATA[

-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID (), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID (), 1) .. " help")
  Note(" to see info about this plugin --")
end


function OnHelp ()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID (), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo (GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/ct_qrewards.xml",
  }
  return (table.concat(t, ";"))
end



-------------------------
-- crystal quests stuff
-------------------------

function crystal_start_capture()
  crystal = {
    exp = "",
    gp = "",
    pp = "",
    qp = "",
  }

  EnableTriggerGroup("capture_crystal", true)
end


function crystal_capture_gold(gp)
  if (gp ~= "0") then
    crystal.gp = gp
  end
end


function crystal_capture_qp(qp)
  if (qp ~= "0") then
    crystal.qp = qp
  end
end


function crystal_capture_exp(exp)
  if (exp ~= "0") then
    crystal.exp = exp
  end
end


function crystal_capture_pp(pp)
  if (pp ~= "0") then
    crystal.pp = pp
  end
end


function crystal_end_capture()
  EnableTriggerGroup("capture_crystal", false)

--  require "serialize"
--  Note(serialize.save_simple(crystal))
  report_rewards("Tadamir", crystal.qp, crystal.exp, "", "", "", crystal.pp, crystal.gp)
end



---------------------
-- ct rewards stuff
---------------------

function report_rewards(qm, qp, exp, ap, bp, piety, pp, gp)
  local i = 1

  local msg = pick_color(i) .. qm .. pick_color(i + 1) .. " quest completed ["
  i = i + 1

  if (qp ~= "") then
    i = i + 1
    msg = msg .. pick_color(i) .. qp .. " qp"
  end

  if (exp ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. exp .. " exp"
  end

  if (ap ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. ap .. " ap"
  end

  if (bp ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. bp .. " bp"
  end

  if (piety ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. piety .. " piety"
  end

  if (pp ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. pp .. " pp"
  end

  if (gp ~= "") then
    i = i + 1
    msg = msg .. ", " .. pick_color(i) .. gp .. " gp"
  end

  msg = msg .. pick_color(2) .. "]"

  Send("clantalk " .. msg)
--  Execute("ct " .. msg)
end


function pick_color(num)
  local col

  if (math.fmod(num, 2) ~= 0) then -- even
    col = GetVariable("col1")
  else -- odd
    col = GetVariable("col2")
  end

  return col
end


]]>

</script>

</muclient>
