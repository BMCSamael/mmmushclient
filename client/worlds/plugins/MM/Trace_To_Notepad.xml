<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, February 05, 2009, 3:33 PM -->
<!-- MuClient version 4.37 -->

<!-- Plugin "Trace_To_Notepad" generated by Plugin Wizard -->

<muclient>

<plugin
   name="Trace_To_Notepad"
   author="Nick Gammon, Ruthgul"
   id="adf79802005a0d6186530bee"
   language="Lua"
   purpose="Redirects trace to a notepad window"
   date_written="2009-02-05 15:32:15"
   date_modified="2014-01-02 10:18:19"
   requires="4.71"
   version="1.0"
   >

<description trim="y">
<![CDATA[

~ Trace_To_Notepad ~

Redirects trace to a notepad window.


Authors: Nick Gammon, Ruthgul

Changes added by Ruthgul:
- added this help screen
- made it work like output_functions, to prevent skipping when new trace lines arrive while we're reading the notepad (when the world window doesn't have focus, all new trace lines are buffered, when the world window regains focus, any buffered lines are appended to the notepad)
- made it compatible with plugins_updater

]]>

</description>

</plugin>



<!--  Aliases  -->

<aliases>

<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^Trace\_To\_Notepad(|( |\:)help)$"
   regexp="y"
   ignore_case="y"
   script="OnHelp"
   sequence="100"
  >
  </alias>

</aliases>


<!--  Script  -->


<script>

<![CDATA[

function OnPluginInstall()
  Note(GetPluginInfo(GetPluginID(), 1) .. ": type " .. GetPluginInfo(GetPluginID(), 1) .. " help to see info about this plugin")

  buffer = {}
end


function OnPluginTrace(line)
  if (GetInfo(113) == false) then
    table.insert(buffer, line)
  else
    AppendToNotepad("Trace", line .. "\r\n")
  end
end


function OnPluginGetFocus()
  if (#buffer > 0) then
    for i, buffered in ipairs(buffer) do
      AppendToNotepad("Trace", buffered .. "\r\n")
    end

    buffer = {}
  end
end


function OnHelp()
  Note(GetPluginInfo(world.GetPluginID(), 3))
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/Trace_To_Notepad.xml",
  }
  return (table.concat(t, ";"))
end


]]>

</script>


</muclient>

