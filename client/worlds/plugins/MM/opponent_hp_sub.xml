<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, April 24, 2012, 12:14 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "opponent_hp_sub" generated by Plugin Wizard -->

<muclient>

<plugin
   name="opponent_hp_sub"
   author="Ruthgul"
   id="1d71bf1797912d451784ca21"
   language="Lua"
   purpose="opponent's health as a %"
   date_written="2012-04-24 12:12:32"
   date_modified="2013-08-02 08:32:27"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.-------------------.
 | opponent_hp_sub |
`-------------------'

Shows a numeric estimation of your opponent's health, as a percentage.


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Variables  -->

<variables>

  <variable name="char_name">[a-zA-Z0-9 \-\,\.\']+</variable>

</variables>



<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   group="script-op_dmg"
   keep_evaluating="y"
   expand_variables="y"
   match="^(@!char_name) (?P&lt;desc&gt;(is in perfect health|is in good health|has several minor scratches|has several minor wounds and bruises|has some significant wounds|has some very significant wounds and scratches|looks pretty beaten up|is in terrible condition|is vomiting blood|screams in agony|pales visibly as death nears|is barely clinging to life))\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>trigger_style_runs = TriggerStyleRuns
subtitle_enemy_hp("%&lt;desc&gt;")
</send>
  </trigger>

</triggers>


<!--  Plugin help  -->

<aliases>

  <alias
   enabled="y"
   match="^opponent_hp_sub(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<script>

<![CDATA[

-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID (), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID (), 1) .. " help")
  Note(" to see info about this plugin --")
end


function OnHelp ()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID (), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo (GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/opponent_hp_sub.xml",
  }
  return (table.concat(t, ";"))
end


--------------------
-- subtitles stuff
--------------------

function subtitle_enemy_hp(desc)
  local damage = {
    ["is in perfect health"] = "100",
    ["is in good health"] = "100",
    ["has several minor scratches"] = "90-100",
    ["has several minor wounds and bruises"] = "75-90",
    ["has some significant wounds"] = "60-75",
    ["has some very significant wounds and scratches"] = "45-60",
    ["looks pretty beaten up"] = "35-45",
    ["is in terrible condition"] = "25-35",
    ["is vomiting blood"] = "15-25",
    ["screams in agony"] = "10-15",
    ["pales visibly as death nears"] = "5-10",
    ["is barely clinging to life"] = "0-5"
  }

  for k, v in ipairs(trigger_style_runs) do
    local newval = string.gsub(v.text, desc, desc .. "[" .. damage[desc] .. "%%%]")
    ColourTell(RGBColourToName(v.textcolour),
               RGBColourToName(v.backcolour),
               newval)
  end -- for each style run

  Note("")
end


]]>

</script>

</muclient>
