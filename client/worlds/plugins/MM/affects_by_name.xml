<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 24, 2011, 7:36 AM -->
<!-- MuClient version 4.73 -->

<!-- Plugin "affects_by_name" generated by Plugin Wizard -->

<muclient>

<plugin
   name="affects_by_name"
   author="Tamlin/Ruthgul"
   id="6010f6bda5ebf2210998613d"
   language="Lua"
   purpose="Subtitles affects. Not all of them. :x"
   date_written="2011-08-24 07:35:19"
   date_modified="2024-01-01 10:22:11"
   requires="4.71"
   version="2.7"
   >

<description trim="y">

<![CDATA[

.-------------------.
 | affects_by_name |
`-------------------'

- Adds names for most buffs/debuffs as they are resisted/land/deal damage on tick/are dispelled/wear off/etc.

- It doesn't show names for positive affects "landing" (eg, when you successfully cast shadow armor).

- It works passively.


** REQUIRES **

- Client setting: Game, Configure, Output > [x] Convert IAC EOR/GA to new line (must be checked).
- MM_GMCP_Handler (plugin id="f67c4339ed0591a5b010d05b") must be installed and enabled (to detect affect applications).
- Game settings: SHOW-AFFECT-SPOILERS must be ON (to detect affects turning off).


** HELP NEEDED **

This plugin is missing stuff for classes I haven't played yet (witch, ranger, bard, etc.), and some older stuff which I haven't been able to figure out yet.

If you find an affect that isn't included in this plugin, or should be moved to a different category, please send Ruthgul a tell, or a parchment (including the full string and what it does, if possible), and I'll update the plugin.


Author: Ruthgul


Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>



<!--  Variables  -->

<variables>

  <variable name="char_name">[a-zA-Z0-9 \-\,\.\']+</variable>

</variables>



<!--  Triggers  -->

<triggers>

<!-- generic spelloff capture -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="\[Off\: You lose (?<spell>.+)\] (?<text>.+)\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_generic_off"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="\[Off\: (?<who>(@!char_name)) loses (?<spell>.+)\] (?<text>.+)\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_generic_off"
  >
  </trigger>


<!-- special cases -->

<!-- Raymatus Lantern-->
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>.+) seems to resist (?<spell>.+)\'s magic\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_mysterious_resist"
  >
  </trigger>

<!-- siphon, timepieces ... are they still needed? -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(@!char_name)( has siphoned the spell effect of|(|\'s) (the legendary timepiece \'(.+)\'|Redemption from the Darkness) glows brightly as it strips) \'(?<spell>.+)\' (from|off of) (?<who>.+)\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_siphon_or_tpdispel"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)\, the Archon Hunter) focuses\, purging \'(?<spell>.+)\' from (her|him)self with a roar\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_siphon_or_tpdispel"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(@!char_name)\, the Archon Hunter\'s magic goes haywire\, tearing \'(?<spell>.+)\' from you\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_siphon_or_tpdispel"
  >
  </trigger>
 
<!-- blindness -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^(A brilliant flare of white light erupts in front of|(A dense black|Black) smoke(| rises from nowhere and) swirls (in front of|about)) (?<who>.+)(\'s eyes\, but (.+) shuts them just in time|\, but nothing else seems to happen)\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_blindness_resist"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) totters suddenly\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_disrupt_sight_resist"
  >
  </trigger>
  
  -- others
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (appears to be blinded\.|is blinded by the smoke\!|has been blinded\!|staggers suddenly(.+) by (.+) mind control\.)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "BLINDNESS", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^(A brilliant flare of white light erupts in front of|(A dense black|Black) smoke(| rises from nowhere and) swirls in front of|a cloud of dust into) (?P&lt;who&gt;.+)('\s eyes\.|\'s eyes\!|\, obscuring (.+) vision\.)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "BLINDNESS", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))( suddenly looks more confident as the haze clouding (.+) vision is lifted| is no longer blinded|\'s eyebrows go crazy as (.+) sight returns|rubs the smoke from (.+) eyes\, regaining the ability to see)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "BLINDNESS off", "%0")
</send>
  </trigger>  

<!-- camoflauge -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^You notice (?P&lt;who&gt;.+) emerge from your peripheral vision\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CAMOUFLAGE off", "%0")
</send>
  </trigger>
  
<!-- change sex -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) doesn\'t look like (him|her|it)self anymore\.\.\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CHANGE SEX on", "%0")
</send>
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s body suddenly changes shape\, and an eldritch glimmer drifts off into the atmosphere\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CHANGE SEX off", "%0")
</send>
  </trigger>
  
<!-- condemn --> 
 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(You|(@!char_name)) condemn(|s) (?P&lt;who&gt;.+) and (his|her|its) armor\, casting (him|her|it) out\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONDEMN armor on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(You|(@!char_name)) condemn(|s) (?P&lt;who&gt;.+) and (his|her|its) magic\, casting (him|her|it) out\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONDEMN magic on", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The condemnation wracking (?P&lt;who&gt;.+)\'s conscience fades\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONDEMN off", "%0")
</send>
  </trigger>
  
<!-- confusion -->
 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) staggers and steps backwards\, shaking (his|her|its) head in confusion\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONFUSION on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^There is a low rumble of thunder as the space surrounding (?P&lt;who&gt;.+) warps and distorts\, as if in pain(.*?)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONFUSION on", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) no longer seems bewildered by (his|her|its) surroundings\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CONFUSION off", "%0")
</send>
  </trigger>

<!-- curse -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) glows with a dark crimson aura that swiftly vanishes\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_curse_resist"
  >
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows briefly with a dark crimson aura\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CURSE on", "%0")
</send>
  </trigger>

<trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) looks less afflicted\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "CURSE off", "%0")
</send>
  </trigger>
 
<!-- deafen -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) stumbles and shakes (.+) head\, as if in pain\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "DEAFEN on", "%0")
</send>
  </trigger>
  
<!-- death grip -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s grip on (his|her|its) weapon loosens\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "DEATH GRIP off", "%0")
</send>
  </trigger>

<!-- desecrate armor - needs strings? -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^You perform an unsightly ritual in front of (?P&lt;who&gt;.+)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "DESECRATE ARMOR on", "%0")
</send>
  </trigger>
  
<!-- disjunction -->
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) staggers suddenly\, and is outlined by a faint amber glow\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "DISJUNCTION on", "%0")</send>
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) shakes (his|her|its) head as the disjunction affecting (him|her|it) fades away\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "DISJUNCTION off", "%0")
</send>
  </trigger>
 
<!-- electrogenic growth - needs strings --> 
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(@!char_name) coats (?P&lt;who&gt;.+) with a glob of mucus\, leaving (him|her|it) conductive but unharmed\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "ELECTROGENIC GROWTH on", "%0")
</send>
  </trigger>
  
<!-- elemental shield -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The rainbow aura surrounding (?P&lt;who&gt;.+) flickers and vanishes\.$"
   omit_from_output="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "ELEMENTAL SHIELD off", "%0")
</send>
  </trigger>
  
<!-- energy orb -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Electrical energy pulses(| and arcs) through(|out) your body\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_energy_orb_tick"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Electrical energy pulses(| and arcs) through(|out) (?<who>.+)\'s body\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_energy_orb_tick"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The electrical energy cracking through (?P&lt;who&gt;.+)\'s body is grounded\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "ENERGY ORB off", "%0")
</send>
  </trigger>
  
 <!-- etheric pollution -->
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s connection to the twin moons\' etheric energy has been disrupted\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_handicap_stuff("%&lt;who&gt;", "ETHERIC POLLUTION on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) shines with the sudden return of energy from the twin moons\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_handicap_stuff("%&lt;who&gt;", "ETHERIC POLLUTION off", "%0")
</send>
  </trigger>
  
<!-- evil eye -->
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) stumbles and almost falls\, and a low gasp escapes from (.+)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "EVIL EYE on", "%0")
</send>
  </trigger>
  
  
<!-- extinction -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^You turn pale(| and shudder) as dark magic burns away some of your life force\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_extinction_tick"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) turns pale and shudders\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_extinction_tick"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows briefly with a maleficent citrine aura\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_critical_stuff("%&lt;who&gt;", "EXTINCTION on", "%0")
</send>
  </trigger>

<!-- faerie fire -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is (outlined by a faint pink glow|surrounded by a pink outline)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FAERIE FIRE on", "%0")</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The pink glow surrounding (?P&lt;who&gt;.+) slowly fades away\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FAERIE FIRE off", "%0")
</send>
  </trigger>
  
<!-- faminee --> 
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Your fingertips brush (?P&lt;who&gt;.+), causing (.+) to gasp in shock\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FAMINE on", "%0")
</send>
  </trigger>

 <!-- fatigue --> 
 
 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is moving more lethargically\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FATIGUE on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) seems refreshed as (his|her|its) focus returns\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FATIGUE off", "%0")
</send>
  </trigger>

<!-- fire invocation -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The elemental flames surrounding (?P&lt;who&gt;.+)\'s body wisp into the ether\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_lethal_stuff("%&lt;who&gt;", "FIRE INVOCATION off", "%0")
</send>
  </trigger>

<!-- fireshield -->
  <trigger
   colour_change_type="1"
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The shield of flames surrounding (?P&lt;who&gt;.+) sputters and goes out\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FIRESHIELD off", "%0")
</send>
  </trigger>

<!-- flintstrike - needs strings -->
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is coated with tinder\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FLINTSTRIKE on", "%0")
</send>
  </trigger>
  
<!-- force field -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The air around (?P&lt;who&gt;.+) becomes less dense\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FORCE FIELD off", "%0")
</send>
  </trigger>
  
<!-- frost -->
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) turns blue and shivers\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FROST on", "%0")
</send>
  </trigger> 
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The frost covering (?P&lt;who&gt;.+) thaws\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FROST off", "%0")
</send>
  </trigger>
  
<!-- fungal growth - needs strings -->
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The fungus leeches into (?P&lt;who&gt;.+)\'s skin\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "FUNGAL GROWTH on", "%0")
</send>
  </trigger>

<!-- haste -->
 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is no longer moving quickly\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "HASTE off", "%0")
</send>
  </trigger>

<!-- herald bloodthirst -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Shrieking mightily\, (?P&lt;who&gt;.+) heralds (his|her|its) own bloodthirstiness\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "HERALD BLOODTHIRST on", "%0")</send>
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The crazed look in (?P&lt;who&gt;.+)\'s bloodshot eyes fades away\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "HERALD BLOODTHIRST off", "%0")
</send>
  </trigger>
  
<!-- hex -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) glows with an ominous crimson aura\, but it fades too quickly\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_hex_resist"
  >
  </trigger>

<trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows briefly with an ominous crimson aura\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "HEX on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The hex placed upon (?P&lt;who&gt;.+) finally loses its hold\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "HEX off", "%0")
</send>
  </trigger>  

<!-- jinx -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) glows with a malevolent mauve aura\, but it fades too quickly\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_jinx_resist"
  >
  </trigger>

<!-- ice invocation -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The air around (?P&lt;who&gt;.+)'s seems clearer\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "ICE INVOCATION off", "%0")
</send>
  </trigger>

<!-- immobilize -->
 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) gasps as the power of your gaze affects (.+)\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "IMMOBILIZE on", "%0")
</send>
  </trigger>  
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s knees nearly buckle as (he|she|it) regains (his|her|its) balance\, no long immobilized\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "IMMOBILIZE off", "%0")
</send>
  </trigger>
  
<!-- impede movement -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) stumbles and staggers under the additional weight (.+) bestowed upon (.+)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "IMPEDE MOVEMENT", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) staggers as (.+) legs start to function properly again\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "IMPEDE MOVEMENT off", "%0")
</send>
  </trigger> 
  
<!-- induce aggression -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) changes (his|her|its) stance and suddenly seems quite a bit more aggressive\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "INDUCE AGGRESSION", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) seems to have adopted a less aggressive stance\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "INDUCE AGGRESSION off", "%0")
</send>
  </trigger>

<!-- insanity -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) flails (.+) arms about wildly\, and gibbers\, shrieking about voices in (.+) head\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "INSANITY on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s eyes look less vacant as the shrieking voices in (.+) head recede\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "INSANITY off", "%0")
</send>
  </trigger>

 <!-- inspirational hymn -->
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s ears perk up as (he|she|it) hears the word of the hymn\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "INSPIRATIONAL HYMN on", "%0")
</send>
  </trigger>
  
<!-- jinx -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows with a malevolent mauve aura\, but it fades too quickly\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "JINX resisted on", "%0")
</send>
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows briefly with a malevolent mauve aura\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "JINX on", "%0")
</send>
  </trigger>

   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) appears less burdened by misfortune\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "JINX off", "%0")
</send>
  </trigger>
  
<!-- lava walk -->  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The protective clumps of smoldering lava on (?P&lt;who&gt;.+)\'s feet solidify and crumble off\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "LAVA WALK off", "%0")
</send>
  </trigger>

<!-- leech conduit - needs strings -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The vampiric conduit wavering from (?P&lt;who&gt;.+)\'s chest dissipates\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "LEECH CONDUIT off", "%0")
</send>
  </trigger>

<!-- levitation -->  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;.(@!char_name)) slowly settles back to the ground\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "LEVITATION off", "%0")
</send>
  </trigger>

<!-- lightning invocation -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The lightning speeding up (?P&lt;who&gt;.+) discharges to the ground\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "LIGHTNING INVOCATION off", "%0")
</send>
  </trigger>
  
<!-- lightning shroud -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The prismatic shroud of lightning surrounding (?P&lt;who&gt;.+) surges\, then discharges harmlessly to the ground\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "LIGHTNING SHROUD off", "%0")
</send>
  </trigger>


<!-- magma invocation -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The flames surrounding (?P&lt;who&gt;.+) flicker and vanish\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MAGMA INVOCATION off", "%0")
</send>
  </trigger>


<!-- malediction -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows with a malevolent fuchsia aura\, but it fades quickly\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MALEDICTION resisted", "%0")
</send>
  </trigger>

<!-- for malediction landing on self, see curse -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) glows briefly with a malevolent fuchsia aura\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MALEDICTION on", "%0")
</send>
  </trigger>

 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Malevolent energy rises from (?P&lt;who&gt;.+) and slowly dissipate(.*?)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MALEDICTION off", "%0")
</send>
  </trigger> 

<!-- malignancy -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^A sickly glow surges around (?<who>.+) only to fade out of existence just as quick\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_malignancy_resist"
  >
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is outlined with a sickly green glow\, briefly\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MALIGNANCY on", "%0")
</send>
  </trigger>

<!-- memory drain -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^You extend your senses into the astral plane\, working on (?P&lt;who&gt;.+)\'s memories\.\.\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MEMORY DRAIN", "%0")
</send>
  </trigger>
  

<!-- mental disruption - needs strings -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="(?<who>(@!char_name)) staggers suddenly."
   omit_from_output="y"
   sequence="100"
   script="on_mental_disruption_resist"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) staggers suddenly as (his|her|its) mind is disrupted by your mental power\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_handicap_stuff("%&lt;who&gt;", "MENTAL DISRUPTION", "%0")
</send>
  </trigger>
  
<!-- mutilate -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^A patina of caustic acid washes over (?P&lt;who&gt;.+) before melting away (.+) skin\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MUTILATE", "%0")
</send>
  </trigger>

    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The hideous scars covering (?P&lt;who&gt;.+)'s face spontaneously heal themselves\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "MUTILATE off", "%0")
</send>
  </trigger>
  
 <!-- ooze invocation -->
 
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The ooze surrounding (?P&lt;who&gt;.+)\'s form evaporates into the air\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "OOZE INVOCATION off", "%0")
</send>
  </trigger>
  
<!-- paralysis -->

 <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) staggers and steps back\, (clutching (his|her|its) head|seemingly winded)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_critical_stuff("%&lt;who&gt;", "PARALYSIS on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) looks less rigid\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "PARALYSIS off", "%0")
</send>
  </trigger>  
  
<!-- pestilence -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The pestilential lesions covering (?P&lt;who&gt;.+) recede with time\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "PESTILENCE off", "%0")
</send>
  </trigger>  
  
<!-- plague -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) seems to resist (.+) magical plague\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_plague_resist"
  >
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^(Ghastly looking sores|More sores) start cropping up on (?P&lt;who&gt;.+)\'s body (.+)\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "PLAGUE on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) gasps as (.+) inhales some of the disease-ridden vapor\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "PLAGUE on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The sores covering (?P&lt;who&gt;.+) suddenly vanish\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "PLAGUE off", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) looks relieved as (.+) (disease|plague) is (cured|burned from (.+) body)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "PLAGUE off", "%0")
</send>
  </trigger>
  
<!-- plodding fugue --> 

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) suddenly looks worn out and exhausted\, as though by a drudging slog\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "PLODDING FUGUE on", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) seems to perk up a bit\, dancing a merry little jig\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "PLODDING FUGUE off", "%0")
</send>
  </trigger> 

<!-- poison -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^A noxious cloud of green gas swirls from (.+) fingertips to (?<who>.+) for a moment\, but nothing else seems to happen\.$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_poison_resist"
  >
  </trigger>
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^A noxious cloud of green gas pours from (.+) fingertips\, swirling about (?P&lt;who&gt;.+)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>if ("%&lt;who&gt;" ~= "you") then
  show_important_stuff("%&lt;who&gt;", "POISON on", "%0")
end
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (looks very ill|appears to be poisoned|coughs and chokes from the toxic gasses wafting through the air)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "POISON on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (appears to look much better|looks relieved as the poison is burned from (.+) body)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "POISON off", "%0")
</send>
  </trigger>
  
<!-- sanctuary -->
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The white aura surrounding (?P&lt;who&gt;.+) fades away\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_lethal_stuff("%&lt;who&gt;", "SANCTUARY off", "%0")
</send>
  </trigger>
  
<!-- shield -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s force shield dissipates\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SHIELD off", "%0")
</send>
  </trigger>  
  
  <!-- silence -->
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (is now|has been) silenced\!$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "SILENCE on", "%0")
</send>
  </trigger>
  
 <!-- sleep -->

<!-- slow ... needs to be separated from hinder, help required -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) seems to resist your enchantment\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_slow_resist"
  >
  </trigger>

<trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) is moving in slow motion\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SLOW on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (seems to be moving at a normal pace again|shrugs off (.+) sluggishness)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "SLOW off", "%0")
</send>
  </trigger>

 <!-- slow magic -->
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^You create a very small temporospatial claudication directly around (?P&lt;who&gt;.+)'s body, and (.+) time field becomes slightly out of sync with everyone else\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SLOW MAGIC on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) appears to be moving much slower\, creating an odd rippling effect in the air around (.+)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SLOW MAGIC on", "%0")
</send>
  </trigger> 
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The rippling effect in the space about (?P&lt;who&gt;.+) seems to dissipate\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SLOW MAGIC off", "%0")
</send>
  </trigger>
  
<!-- smoke invocation -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^(?P&lt;who&gt;(@!char_name)) fades into existence\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SMOKE INVOCATION off", "%0")
</send>
  </trigger>

<!-- soothing nocturne - needs strings -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) falters momentarily\, as though distracted by the soothing song$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_soothing_nocturne_resist"
  >
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) falters\, distracted by the beauty of the nocturne\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SOOTHING NOCTURNE on", "%0")
</send>
  </trigger>
  
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^Catching a lucky break\, (?P&lt;who&gt;.+) trips over a crack and is startled out of the nocturne\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SOOTHING NOCTURNE off", "%0")
</send>
  </trigger>
 
<!-- spell shield -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The shimmering bands of light surrounding (?P&lt;who&gt;.+) fade and vanish\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "SPELL SHIELD off", "%0")
</send>
  </trigger>
  
<!-- stone curse -->

   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The curse of stone affecting (?P&lt;who&gt;.+) wears off suddenly\, and (.+) begins to move again\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "STONE CURSE off", "%0")
</send>
  </trigger>

 <!-- steam invocation --> 
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) becomes more opaque as (his|her|its) steamy form solidifies\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "STEAM INVOCATION off", "%0")
</send>
  </trigger>

<!-- stone skin -->

   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name))\'s skin looks normal again\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "STONE SKIN off", "%0")
</send>
  </trigger>

 <!-- weaken --> 
 
   <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) shudders\, staggers\, and almost falls\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "WEAKEN on", "%0")
</send>
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) appears to feel stronger\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "WEAKEN off", "%0")
</send>
  </trigger> 

<!-- web - needs new mesmerize wear off strings -->

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?<who>(@!char_name)) (dodges out of the way of your vines|manages to brush the spiders off (him|her) just in time)\!$"
   omit_from_output="y"
   regexp="y"
   sequence="100"
   script="on_web_resist"
  >
  </trigger>
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (is enmeshed in thick webbing produced by the spiders\!|stares deeply into (.+) eyes\, seemingly unable to move\.)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "WEB on", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^(The ground cracks and splits\, and thick\, dark green vines sprout from the earth\, restraining|A thick\, meshy web falls from somewhere above) (?P&lt;who&gt;.+)(\!|\, entangling (him|her|it) with sticky ropes\.)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_important_stuff("%&lt;who&gt;", "WEB on", "%0")
</send>
  </trigger> 
  
    <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   match="^The (vines|webs) (binding|wrapped around) (?P&lt;who&gt;.+) (dissolve|wither and loosen)\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "WEB off", "%0")
</send>
  </trigger>

  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) (breaks free from the webs holding (.+) in place\!|can now move about freely again as the forces affecting (.+) subside\.)$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "WEB off", "%0")
</send>
  </trigger>
  
  <!-- whirlwind -->
  
  <trigger
   enabled="y"
   group="affects"
   keep_evaluating="y"
   expand_variables="y"
   match="^(?P&lt;who&gt;(@!char_name)) stops moving as though empowered by a whirlwind\.$"
   omit_from_output="y"
   regexp="y"
   send_to="14"
   sequence="100"
  >
  <send>show_other_stuff("%&lt;who&gt;", "WHIRLWIND off", "%0")
</send>
  </trigger>

</triggers>

<!--  Aliases  -->

<aliases>

  <alias
   enabled="y"
   match="^clear events$"
   regexp="y"
   sequence="100"
   script="clear_events"
  >
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   match="^affects\_by\_name(|( |\:)help)$"
   regexp="y"
   script="OnHelp"
  >
  </alias>

</aliases>



<!--  Scripts  -->

<script>

<![CDATA[

debug = false

require "wait"
require "gmcphelper"


-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  wait.make(function()
    Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
    ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
    Note(" to see info about this plugin --")

    -- give the plugins time to initialize
    wait.time(3)
    detect_plugins()
  end)
end


function OnPluginListChanged()
  detect_plugins()
end


function detect_plugins()
  use_sapi = sapi_plugin_present()
  reader_present = reader_plugin_present()
end


function is_plugin_present(name, id)
  local res = false

  local plugin_name = GetPluginInfo(id, 1)

  if (plugin_name == name) then
    -- is it enabled?
    if (GetPluginInfo(id, 17)) then
      res = true
    end
  end

  return res
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/BMCSamael/mmmushclient/master/src/affects_by_name.xml",
  }
  return (table.concat(t, ";"))
end


---------------
-- GMCP stuff
---------------

function OnPluginBroadcast(msg, id, name, text)
  if (id =="f67c4339ed0591a5b010d05b") then -- GMCP message
    if (text == "char.affect_application_msg") then
      on_gmcp_generic_on()
    elseif (text == "char.affect_removal_msg") then
      on_gmcp_generic_off()
    end
  end
end


function on_gmcp_generic_on()
  get_affect_application()
  who = gmcpval("target")
  spell = gmcpval("skill"):upper()
  affect = gmcpval("modifies")
  modifier = gmcpval("modifier")
  
  if (who == "you") then
    text = who .. ": Affect: " .. affect .. " by " .. modifier
  end
  
  categorize_and_show_affect(text, who, spell, "on")
end


function on_gmcp_generic_off()
  get_affect_removal()
  who = gmcpval("target")
  spell = gmcpval("skill"):upper()
  
  if (who == "you") then
    text = who .. ": Affect: " .. affect 
  end
  
  categorize_and_show_affect(who, who, spell, "off")
end


function get_affect_application()
  local res, gmcparg = CallPlugin("f67c4339ed0591a5b010d05b", "gmcpval", "char.affect_application_msg")
  luastmt = "gmcpdata = " .. gmcparg
  assert(loadstring(luastmt or ""))()
end

function get_affect_removal()
  local res, gmcparg = CallPlugin("f67c4339ed0591a5b010d05b", "gmcpval", "char.affect_removal_msg")
  luastmt = "gmcpdata = " .. gmcparg
  assert(loadstring(luastmt or ""))()
end


---------------------
-- general captures
---------------------

function on_generic_off(name, line, wildcards)
  local who = wildcards.who or "you"
  local spell = wildcards.spell
  local text = wildcards.text
  categorize_and_show_affect(text, who, spell, "off")
end


function categorize_and_show_affect(line, who, spell, onoff)

  local affect = spell .. " " .. onoff
  if (is_lethal(affect, who)) then
    show_lethal_stuff(who, affect, line)
  elseif (is_critical(affect, who)) then
    show_critical_stuff(who, affect, line)
  elseif (is_handicap(affect, who)) then
    show_handicap_stuff(who, affect, line)
  elseif (is_important(affect, who)) then
    show_important_stuff(who, affect, line)
  elseif (is_buff(affect, who)) then
    show_buff_stuff(who, affect, line)
  else
    show_other_stuff(who, affect, line)
  end
end

t_buff_stuff = {
  ["fire invocation on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["blessing of ithrilis on"] = {
    ["self"] = true,
  },
  ["mental clarity on"] = {
    ["self"] = true,
  },
  ["fire invocation off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["blessing of ithrilis off"] = {
    ["self"] = true,
  },
  ["mental clarity off"] = {
    ["self"] = true,
  },
  ["frostborne on"] = {
    ["self"] = true,
  },
  ["frostborne off"] = {
    ["self"] = true,
  },
    ["glacierskin off"] = {
    ["self"] = true,
  },
    ["glacierskin off"] = {
    ["self"] = true,
  },  
  ["armor on"] = {
    ["self"] = true,
    ["others"] = true,
  },
}

function is_buff(affect, who)
  return is_category(t_buff_stuff, affect, who)
end

t_lethal_stuff = {
  ["fire invocation off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["sanctuary off"] = {
    ["self"] = true,
    ["others"] = true,
  },
   ["paralysis off"] = {
    ["self"] = true,
	["others"] = true,
  },
}
function is_lethal(affect, who)
  return is_category(t_lethal_stuff, affect, who)
end


t_critical_stuff = {
  ["energy orb on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["extinction on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["hinder off"] = {
    ["others"] = true,
  },
}
function is_critical(affect, who)
  return is_category(t_critical_stuff, affect, who)
end


t_handicap_stuff = {
  ["blindness on"] = {
    ["self"] = true,
  },
  ["confusion on"] = {
    ["self"] = true,
  },
  ["deafen on"] = {
    ["self"] = true,
  },
  ["disrupt sight on"] = {
    ["self"] = true,
  },
  ["earth evocation on"] = {
    ["self"] = true,
  },
  ["etheric pollution on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["hinder magic on"] = {
    ["self"] = true,
  },
  ["mental disruption on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["mesmerize on"] = {
    ["self"] = true,
  },
  ["mutilate on"] = {
    ["self"] = true,
  },
  ["pestilence on"] = {
    ["self"] = true,
  },
  ["silence on"] = {
    ["self"] = true,
  },
  ["sleep on"] = {
    ["self"] = true,
  },
  ["sleep on"] = {
    ["self"] = true,
  },
  ["slow magic on"] = {
    ["self"] = true,
  },
  ["smoke evocation on"] = {
    ["self"] = true,
  },
  ["stone curse on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["web on"] = {
    ["self"] = true,
  },
}
function is_handicap(affect, who)
  return is_category(t_handicap_stuff, affect, who)
end


t_important_stuff = {
  ["aegis off"] = {
    ["self"] = true,
  },
  ["air invocation off"] = {
    ["self"] = true,
  },
  ["armor off"] = {
    ["self"] = true,
  },
  ["ash invocation off"] = {
    ["self"] = true,
  },
  ["augment aura off"] = {
    ["self"] = true,
  },
  ["blindness on"] = {
    ["others"] = true,
  },
  ["blindness off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["bubble cluster off"] = {
    ["self"] = true,
  },
  ["combat blink off"] = {
    ["self"] = true,
  },
  ["combat blink on"] = {
    ["self"] = true,
  },
  ["detect illusion off"] = {
    ["self"] = true,
  },
  ["detect invisibility off"] = {
    ["self"] = true,
  },
  ["disrupt sight on"] = {
    ["others"] = true,
  },
  ["disrupt sight off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["dust invocation off"] = {
    ["self"] = true,
  },
  ["earth evocation on"] = {
    ["others"] = true,
  },
  ["earth evocation off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["elemental shield off"] = {
    ["self"] = true,
  },
  ["etheric pollution off"] = {
    ["self"] = true,
  },
  ["float off"] = {
    ["self"] = true,
  },
  ["force field off"] = {
    ["self"] = true,
  },
  ["haste off"] = {
    ["self"] = true,
  },
  ["hinder on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["hinder magic on"] = {
    ["others"] = true,
  },
  ["hinder magic off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["ice invocation off"] = {
    ["self"] = true,
  },
  ["improved invisibility off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["invisibility off"] = {
    ["self"] = true,
  },
  ["irritation"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["irritation off"] = {
    ["others"] = true,
  },
  ["lava walk off"] = {
    ["self"] = true,
  },
  ["levitation off"] = {
    ["self"] = true,
  },
  ["lightning invocation off"] = {
    ["self"] = true,
  },
  ["mysterious forces on"] = {
    ["self"] = true,
  },
  ["memory drain on"] = {
    ["self"] = true,
  },
  ["mesmerize on"] = {
    ["others"] = true,
  },
  ["mesmerize off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["mind shield off"] = {
    ["self"] = true,
  },
  ["ooze invocation off"] = {
    ["self"] = true,
  },
  ["phalanx off"] = {
    ["self"] = true,
  },
  ["plague on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["plague off"] = {
    ["others"] = true,
  },
  ["poison on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["poison off"] = {
    ["others"] = true,
  },
  ["radiance invocation off"] = {
    ["self"] = true,
  },
  ["shadow armor off"] = {
    ["self"] = true,
  },
  ["shape shifting off"] = {
    ["self"] = true,
  },
  ["shield off"] = {
    ["self"] = true,
  },
  ["silence on"] = {
    ["others"] = true,
  },
  ["silence off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["sleep off"] = {
    ["self"] = true,
  },
  ["slow on"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["slow off"] = {
    ["others"] = true,
  },
  ["slow magic on"] = {
    ["others"] = true,
  },
  ["slow magic off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["smoke invocation off"] = {
    ["self"] = true,
  },
  ["stone skin off"] = {
    ["self"] = true,
  },
  ["telekinetic shield off"] = {
    ["self"] = true,
  },
  ["underwater breathing off"] = {
    ["self"] = true,
  },
  ["water invocation off"] = {
    ["self"] = true,
  },
  ["web on"] = {
    ["others"] = true,
  },
  ["web off"] = {
    ["self"] = true,
    ["others"] = true,
  },
  ["whirlwind off"] = {
    ["self"] = true,
  },
}
function is_important(affect, who)
  return is_category(t_important_stuff, affect, who)
end


function is_category(t, affect, who)
  local target = "others"
  if (who == "you") then
    target = "self"
  end
  local item = t[affect:lower()]
  if (item) then
    return item[target]
  else
    return false
  end
end



---------------------
-- special captures
---------------------

function on_mysterious_resist(name, line, wildcards)
  local who = wildcards.who or "you"
  local spell = wildcards.spell

  show_critical_stuff(who, spell, "resisted")
end

function on_siphon_or_tpdispel(name, line, wildcards)
  local who = wildcards.who or "you"
  local spell = wildcards.spell

  categorize_and_show_affect(line, who, spell, "off")
end


function on_blindness_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "BLINDNESS resisted", line)
end


function on_curse_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "CURSE resisted", line)
end


function on_disrupt_sight_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "DISRUPT SIGHT resisted", line)
end


function on_energy_orb_tick(name, line, wildcards)
  local who = wildcards.who or "you"
  show_critical_stuff(who, "ENERGY ORB tick", line)
end


function on_extinction_tick(name, line, wildcards)
  local who = wildcards.who or "you"
  show_critical_stuff(who, "EXTINCTION tick", line)
end


function on_hex_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "HEX resisted", line)
end


function on_jinx_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "JINX resisted", line)
end


function on_malignancy_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "MALIGNANCY resisted", line)
end


function on_mental_disruption_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "MENTAL DISRUPTION resisted", line)
end


function on_plague_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "PLAGUE resisted", line)
end


function on_poison_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "POISON resisted", line)
end


function on_slow_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "SLOW resisted", line)
end


function on_soothing_nocturne_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "SOOTHING NOCTURNE resisted", line)
end


function on_web_resist(name, line, wildcards)
  local who = wildcards.who
  show_other_stuff(who, "WEB resisted", line)
end



-------------------------------------------
-- show specific stuff, by type of affect
-------------------------------------------

function show_other_stuff(who, subtitle, line)
  -- colors we'll use to show it
  local fgcolor = "black"
  local bgcolor = "gray"

  show_affect(who, fgcolor, bgcolor, subtitle, line)
end

function show_buff_stuff(who, subtitle, line)
  -- colors we'll use to show it
  local fgcolor = "black"
  local bgcolor = "lightcoral"
  
  if (string.match(subtitle, " off")) then
    bgcolor = "lightcoral"
  else
	bgcolor = "lightgreen"
  end 
  
  show_affect(who, fgcolor, bgcolor, subtitle, line)
end


function show_important_stuff(who, subtitle, line)
  -- an affect that I can/should do something about (re-cast, re-equip, cure, etc.)
  -- an affect that is ok to land on opponents (eg, blindness, poison), but is bad on form members

  -- colors we'll use to show it
  local fgcolor = "black"
  local bgcolor = "goldenrod"

  show_affect(who, fgcolor, bgcolor, subtitle, line)
end


function show_handicap_stuff(who, subtitle, line)
  -- an affect that disables me somehow (eg, silence, paralysis, sleep, slow), and there's nothing I can do about it

  -- colors we'll use to show it
  local fgcolor = "black"
  local bgcolor = "sandybrown"

  show_affect(who, fgcolor, bgcolor, subtitle, line)
end


function show_critical_stuff(who, subtitle, line)
  -- an affect that needs full attention (eg, extinction, paralysis on form members, energy orb)

  -- colors we'll use to show it
  local fgcolor = "white"
  local bgcolor = "green"

  show_affect(who, fgcolor, bgcolor, subtitle, line)
end


function show_lethal_stuff(who, subtitle, line)
  -- an affect LOSS that can kill us if we don't take care of it (eg, sanctuary off!)

  -- colors we'll use to show it
  local fgcolor = "white"
  local bgcolor = "firebrick"

  show_affect(who, fgcolor, bgcolor, subtitle, line)
end



------------
-- general
------------

function show_affect(who, fgcolor, bgcolor, subtitle, line)
  local showtext = ""
  if (not reader_present) then
	
    -- if MushReader isn't present, show subtitles + the affects line
    if (string.lower(who) ~= "you") then
      showtext = showtext .. who .. ": "
    end

    showtext = showtext .. subtitle .. " > "
    
    if (line) and (line ~= "") then
      showtext = showtext .. line
    end
	
    ColourTell(fgcolor, bgcolor, showtext .. "\r\n")
	ColourTell("white", "black", "\r")

  else
    -- if MushReader is present, SAPI say the subtitles
    local txt = ""
    if (string.lower(who) ~= "you") then
      txt = who .. ": "
    end
    txt = txt .. subtitle

    if (who == "you") and (fgcolor == "white") and (bgcolor == "red") then
    -- lethal stuff, so we need to inform immediately
      local res = sapi_interrupt(txt)

      if (res ~= 0) then
      -- speak_interrupt() not present in the plugin
        sapi_say(txt)
      end

    else
      sapi_say(txt)
    end
  end

  -- add to events mini, if it's present
  add_to_events_world(who, fgcolor, bgcolor, showtext)

  -- broadcast the info, for events_mini and similar plugins
  local t = {
    [1] = who,
    [2] = fgcolor,
    [3] = bgcolor,
    [4] = showtext,
  }
  BroadcastPlugin(1, table.concat(t, ";"))

  if (debug)
  and ((string.find(showtext, "off"))
  or (string.find(showtext, "tick"))) then
    AppendToNotepad("tick", "\r\n[" .. os.date("%H:%M:%S") .. "] " .. showtext .. " ", "\r\n")
  end
end



-----------------------
-- events world stuff
-----------------------

function add_to_events_world(who, fgcol, bgcol, subtitle)
  local events = GetWorld("events")
  -- gotta check every time in case they close it

  if (events) then
    --if (string.lower(who) ~= "you") then
    --  events:ColourTell("silver", "black", who .. ": ")
    --end

    events:ColourNote(fgcol, bgcol, subtitle)
    events:ColourNote("silver", "black", subtitle)
  end
end


function clear_events()
  local events = GetWorld("events")
  if (events) then
    events:DeleteOutput()
    events:Pause(false)
  end
end



------------------------
-- sapi / reader stuff
------------------------

function sapi_say(text)
  local res

  if (use_sapi) then
    res = CallPlugin("463242566069ebfd1b379ec1", "say", text)
  end

  return res
end


function sapi_interrupt(text)
  local res

  if (use_sapi) then
    res = CallPlugin("463242566069ebfd1b379ec1", "speak_interrupt", text)
  end

  return res
end


function sapi_plugin_present()
  return is_plugin_present("Sapi_speaker", "463242566069ebfd1b379ec1") or is_plugin_present("Text_To_Speech", "463242566069ebfd1b379ec1")
end


function reader_plugin_present()
  return is_plugin_present("MushReader", "925cdd0331023d9f0b8f05a7")
end


]]>

</script>

</muclient>
