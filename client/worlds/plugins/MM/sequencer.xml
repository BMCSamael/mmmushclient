<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, August 11, 2012, 2:39 PM -->
<!-- MuClient version 4.81 -->

<!-- Plugin "sequencer" generated by Plugin Wizard -->

<muclient>

<plugin
   name="sequencer"
   author="Ruthgul"
   id="7daf1d7890d9db73d74a8188"
   language="Lua"
   purpose="sequences a list of commands"
   save_state="y"
   date_written="2013-07-05 10:44:31"
   date_modified="2015-04-19 08:06:38"
   requires="4.71"
   version="1.0"
   >

<description trim="y">

<![CDATA[

.-------------.
 | sequencer |
`-------------'

Sends a list of commands to the MUD, 1 at a time, to avoid spamming.


** REQUIRES **

- If you're using the character ; (semicolon) for command stacking, you will need to double it to sequence commands. (See example below.)
- The character ; (semicolon) cannot be in assigned for speedwalk prefix, scripts prefix, or any other client feature.
- detect_globals (plugin id="d900cb999816b1f6f2d4bdc5") must be installed and enabled.


Syntax:

* sequence commands <;_separated_list>  - eg, sequence commands open north;look north

  Note: if you're using ; for command stacking, then you need to double it when you call sequence commands, like this:  sequence commands open north;;look north


Author: Ruthgul

Latest version:
http://github.com/MateriaMagicaLLC/mm-mushclient-scripts

]]>

</description>

</plugin>


<!--  Aliases  -->

<aliases>

  <alias
   enabled="y"
   name="sequence"
   match="^sequence commands(?P&lt;list&gt;.+)$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>start_sequence("%&lt;list&gt;")
</send>
  </alias>


<!--  Plugin help  -->

  <alias
   enabled="y"
   script="OnHelp"
   match="^sequencer(|(\:| )help)$"
   regexp="y"
   >
  </alias>
</aliases>



<!--  Triggers  -->

<triggers>

<!-- on prompt -->

  <trigger
   name="sequence_commands"
   keep_evaluating="y"
   match="^(|[^ ]+(.*?))(\&lt;(.+)hp (.+)sp (.+)st\&gt;|\(.+\)|\&gt;) $"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>send_next_command()
</send>
  </trigger>

</triggers>



<!--  Scripts  -->

<script>

<![CDATA[

debug = true;


-----------------
-- plugin stuff
-----------------

function OnPluginInstall()
  Tell("-- " .. GetPluginInfo(GetPluginID(), 1) .. ": type ")
  ColourTell("silver", "black", GetPluginInfo(GetPluginID(), 1) .. " help")
  Note(" to see info about this plugin --")

  EnableTrigger("sequence_commands", false)
end


function OnPluginConnect()
  EnableTrigger("sequence_commands", false)
end


function OnHelp()
  ColourNote("silver", "black", world.GetPluginInfo(world.GetPluginID(), 3))
  Note("")
  ColourNote("silver", "black", "(this version: " .. os.date("%c", GetPluginInfo(GetPluginID(), 14)) .. ")")
end


function plugin_update_url()
  local t = {
    "https://raw.githubusercontent.com/MateriaMagicaLLC/mm-mushclient-scripts/master/src/sequencer.xml",
  }
  return (table.concat(t, ";"))
end



--------------
-- sequencer
--------------

function start_sequence(list)
  -- list must be a list of commands separated by ;

  local s = string.gsub(list, "; ", ";")
  if (debug) then
    Note(s)
  end

  t_sequence = utils.split(s, ";")
  if (debug) then
    require "serialize"
    Note(serialize.save_simple(t_sequence))
  end

  if (#t_sequence >= 1) then
    if (debug) then
      Note("sequencing: " .. serialize.save_simple(t_sequence))
    end

    EnableTrigger("sequence_commands", true)
    i_sequence = 1
    Execute(t_sequence[i_sequence])

  else
    Note("sequencing failed - wrong parameter")
  end

  t = nil
end


function send_next_command()
  if (i_sequence) then
    i_sequence = i_sequence + 1

    if (i_sequence <= #t_sequence) then
      Execute(t_sequence[i_sequence])

    else
      Note("-- sequencer: done! --")
      EnableTrigger("sequence_commands", false)
    end

  else
    EnableTrigger("sequence_commands", false)
  end
end

]]>

</script>

</muclient>
